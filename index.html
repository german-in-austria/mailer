<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>   
    <!-- jQuery UI 1.11.4 -->
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
  <!-- Spectrum plugin (optional) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.0/spectrum.min.js"></script>
  <!-- Meme Generator plugin -->
  <script type="text/javascript" src="/jquery-memegenerator.min.js"></script>
  <!-- jQuery UI CSS file -->
  <link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <!-- Spectrum CSS file (optional) -->
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.0/spectrum.min.css">
  <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/>
  <!-- Meme Generator CSS file -->
  <link rel="stylesheet" type="text/css" href="/jquery-memegenerator.min.css">
  <link href="https://fonts.googleapis.com/css?family=Monoton" rel="stylesheet">
</head>
<body>
  <div class="image-container">
    <br>
    <h1 class="headline">DiÖ-Meme-<br>Generator</h1><br>
    <h5 class="center">1. Wähle ein Bild</h5><br>
    <div class="images container">
      <div style="background-image: url(/1.jpg)" class="img-inner">
        <img src="/1.jpg" />
      </div>
      <div style="background-image: url(/2.jpg)" class="img-inner">
        <img src="/2.jpg" />
      </div>
      <div style="background-image: url(/3.jpg)" class="img-inner">
        <img src="/3.jpg" />
      </div>
      <div style="background-image: url(/4.jpg)" class="img-inner">
        <img src="/4.jpg" />
      </div>
      <div style="background-image: url(/5.jpg)" class="img-inner">
        <img src="/5.jpg" />
      </div>
      <div style="background-image: url(/6.jpg)" class="img-inner">
        <img src="/6.jpg" />
      </div>
      <div style="background-image: url(/7.jpg)" class="img-inner">
        <img src="/7.jpg" />
      </div>
      <div style="background-image: url(/8.jpg)" class="img-inner">
        <img src="/8.jpg" />
      </div>
    </div>
  </div>
  <div class="container pt-4">
    <h5 class="center">2. Text positionieren</h5><br>
  </div>
  <div class="container pt-4">
    <img width="300" src="/1.jpg" id="meme">
  </div>
  <div class="container pt-4">
    <h5 class="center">3. Senden und Download</h5><br>
    <form class="personal needs-validation" novalidate>
      <div class="row">
        <div class="col-sm">
          <div class="form-group mb-3">
            <label for="email">Email*</label>
            <input name="email" type="email" class="form-control" id="email" required />
            <small id="emailHelp" class="form-text text-muted">Wir senden keine Werbung und geben ihre E-Mail-Adresse nicht weiter.</small>
            <div class="invalid-feedback">
              Bitte geben sie eine gültige E-Mail-Adresse an.
            </div>
          </div>
          <div class="form-group mb-3">
            <label for="age">Alter</label>
            <select name="age" class="form-control" id="age">
              <option>unter 15</option>
              <option>15-20</option>
              <option>20-30</option>
              <option>30-50</option>
              <option>über 50</option>
            </select>
          </div>
          <div class="form-group mb-3">
            <label for="geburtsort">Geburtsort</label>
            <input name="geburtsort" class="form-control" id="geburtsort" type="text" placeholder="Geburtsort">
          </div>
          <div class="form-group mb-3">
            <label for="wohnort">Wohnort</label>
            <input name="wohnort" class="form-control" id="wohnort" type="text" placeholder="Wohnort">
          </div>
        </div>
        <div class="col-sm">
          <div class="form-group mb-3">
            <label for="geschlecht">Soziales Geschlecht</label>
            <select name="geschlecht" class="form-control" id="geschlecht">
              <option>männlich</option>
              <option>weiblich</option>
              <option>divers</option>
            </select>
          </div>
          <div class="form-group form-check">
            <input name="dialekt" type="checkbox" class="form-check-input" id="dialekt">
            <label class="form-check-label" for="dialekt">Ich spreche Dialekt</label>
          </div>
          <div class="form-group mb-3">
            <label for="dialekt_alltag">Ich spreche im Alltag Dialekt</label>
            <select name="dialekt" class="form-control" id="dialekt_alltag">
              <option>ja</option>
              <option>nein</option>
              <option>manchmal</option>
            </select>
          </div>
          <div class="form-group mb-3">
            <label for="dialekt_bezeichnung">Wie würdest du deinen Dialekt bezeichnen?</label>
            <input name="dialekt_bezeichnung" class="form-control" id="dialekt_bezeichnung" type="text">
          </div>
        </div>
      </div>
      <div class="row">
        <button id="save" class="btn btn-default mb-5">Senden & Download</button>
      </div>
    </form>
  </div>
  <script>
    function getTemplate(name) {
      var h = document.querySelector('.'+ name +'-template').innerHTML
      document.querySelector('.'+ name +'-template').innerHTML = ''
      return h
    }

    function getFormValues() {
      return $('form.personal').serializeArray()
    }

    $.fn.memeGenerator("i18n", "de", {
      topTextPlaceholder: "TEXT OBEN",
      bottomTextPlaceholder: "TEXT UNTEN",
      addTextbox: "Textfeld hinzufügen",
    })

    $(document).ready(function(){
      $("#meme").memeGenerator({
        // useBootstrap: true,
        layout: 'horizontal',
        defaultTextStyle: {
          color: "#FFFFFF",
          size: 80,
          lineHeight: 1.2,
          font: "Impact, Arial",
          style: "normal",
          forceUppercase: true,
          borderColor: "#000000",
          borderWidth: 4,
        },
        showAdvancedSettings: false,
        captions: [
          'Text oben',
          'Text unten'
        ],
        onInit: () => {
          $("#save").click(function(e){
            e.preventDefault()
            e.stopPropagation()
            var form = document.querySelector('form.personal')

            if (form.checkValidity() === false) {
              console.log('invalid')
            } else {
              console.log('valid')
              var imageDataUrl = $("#meme").memeGenerator("save")
              $("#meme").memeGenerator("download", "image.png");
              $.ajax({
                url: "/sendmail",
                type: "POST",
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify({
                  image: imageDataUrl,
                  personal: getFormValues()
                }),
                dataType: "json",
                success: function(response){
                  
                }
              })
            }
            form.classList.add('was-validated')
          })
        }
      })
      $('.images img').on('click', (e) => {
        function toDataURL(url, callback) {
          var xhr = new XMLHttpRequest();
          xhr.onload = function() {
            var reader = new FileReader();
            reader.onloadend = function() {
              callback(reader.result);
            }
            reader.readAsDataURL(xhr.response);
          };
          xhr.open('GET', url);
          xhr.responseType = 'blob';
          xhr.send();
        }
        $('img.active').removeClass('active')
        $(e.target).addClass('active')
        // toDataURL(e.target.src, function(dataUrl) {
        //   $('#meme').attr('src', dataUrl)
        // })
        $('#meme').attr('src', e.target.src)
      })
    })
    

  </script>
  <style>
  .image-container{
    padding: 10px 0;
    background: #f4f4f4;
  }
  h1.headline{
    font-family: 'Monoton', cursive;
    font-size: 4em;
    color: orange;
    text-align: center;
  }

.center{
  text-align: center
}
  .images{
    overflow-x: scroll;
    white-space: nowrap;
    height: 150px;
    overflow-y: hidden;
  }
  .img-inner{
    display: inline-block;
    width: 150px;
    height: 150px;
    background-position: center center;
    background-size: cover;
  }
  .images img{
    transition: transform .2s;
    margin: auto;
    height: 150px;
    width: 150px;
    cursor: pointer;
    opacity: 0;
  }
  #save{
    background: cornflowerblue;
    color: white;
    margin: 0 auto;
    width: 250px;
    display: block;
    font-size: 1.1em;
    margin-top: 2em;
  }
  .mg-toolbox-toggle{
    display: none !important;
  }
  .template{
    display: none
  }
  </style>
</body>
</html>
